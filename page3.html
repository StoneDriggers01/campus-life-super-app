<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Campus Life Super App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="text-center mb-4">
    <h1 class="custom-gold-font">Erskine College</h1>
    <p class="custom-gold-subheader">Staff Page</p>
    <div class="button-container">
      <a href="page2.html" class="button">Events</a>
      <a href="index.html" class="button">Home</a>
      <a href="page4.html" class="button">Dining</a>
      <a href="page5.html" class="button">Map</a>
      <a href="page6.html" class="button">About</a>
    </div>
  </header>

  <main class="container mt-4">
    <!-- Search bar -->
    <div class="mb-3">
      <label for="searchInput" class="form-label custom-gold-subheader">Search Staff</label>
      <input type="text" id="searchInput" class="form-control" placeholder="Type a name or department...">
    </div>

    <!-- Staff results directly under search bar -->
    <div id="staffList" class="mt-3"></div>
  </main>

  <p class="text-center mt-4">Copyright EC2025</p>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  const staffApiUrl = "https://www.erskine.edu/wp-json/wp/v2/pages?slug=faculty-staff-directory";
  let staffData = [];

  async function loadStaff() {
    try {
      const response = await fetch(staffApiUrl);
      const data = await response.json();

      if (!data.length || !data[0].content) {
        console.error("Staff directory not found");
        return;
      }

      const htmlContent = data[0].content.rendered;
      const parser = new DOMParser();
      const doc = parser.parseFromString(htmlContent, "text/html");

      const staffEntries = doc.querySelectorAll(
        ".vcex-staff-grid-wrap .staff-entry, .vcex-staff-grid-wrap .vcex-staff-entry, .vcex-staff-grid-wrap div"
      );

      staffData = Array.from(staffEntries).map(entry => {
        const nameEl = entry.querySelector(".staff-entry-title, h3, h4, strong");
        const detailEls = entry.querySelectorAll("p, .staff-entry-details");
        const name = nameEl ? nameEl.textContent.trim() : "";
        let details = Array.from(detailEls)
          .map(el => el.textContent.trim())
          .filter(text => text.length > 0)
          .join(" | ");

        // ✅ Clean redundant text
        details = details
          .replace(/Phone NumberEmail/gi, "")
          .replace(/\s+/g, " ")
          .trim();

        // ✅ Remove duplicate name from details
        if (name && details.toLowerCase().includes(name.toLowerCase())) {
          details = details.replace(new RegExp(name, "gi"), "").trim();
        }

        return { name, details };
      })
      .filter(staff => staff.name.length > 0)
      .filter(staff => staff.details.length < 200);

      // ✅ Deduplicate by name
      const uniqueStaff = [];
      const seen = new Set();
      for (const staff of staffData) {
        const key = staff.name.toLowerCase();
        if (!seen.has(key)) {
          seen.add(key);
          uniqueStaff.push(staff);
        }
      }
      staffData = uniqueStaff;

      renderStaff(staffData);
    } catch (error) {
      console.error("Error loading staff:", error);
    }
  }

  function renderStaff(list) {
    const staffList = document.getElementById("staffList");
    staffList.innerHTML = "";
    list.forEach(staff => {
      const card = document.createElement("div");
      card.className = "card staff-card mb-2";
      card.innerHTML = `
        <div class="card-body">
          <h5 class="card-title">${staff.name}</h5>
          <p class="card-text">${staff.details}</p>
        </div>
      `;
      staffList.appendChild(card);
    });
  }

  document.getElementById("searchInput").addEventListener("input", function(e) {
    const query = e.target.value.toLowerCase();
    const filtered = staffData.filter(staff =>
      staff.name.toLowerCase().includes(query) ||
      staff.details.toLowerCase().includes(query)
    );
    renderStaff(filtered);
  });

  document.getElementById("searchInput").addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      e.preventDefault();
      const query = e.target.value.toLowerCase();
      const filtered = staffData.filter(staff =>
        staff.name.toLowerCase().includes(query) ||
        staff.details.toLowerCase().includes(query)
      );
      renderStaff(filtered);
    }
  });

  loadStaff();
  </script>
</body>
</html>